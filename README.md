# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build

```

## Данные и типы данных, используемые в приложении
- Интерфейс списка товаров
```
interface IProductItemListData {

    Свойства:

    productItemList: IProductItem[] - список карточек с сервера
    
    Методы:

    getProductItem(id:string):IProductItem - получение данных карточки товара по id
}
```
- Карточка товара
```
interface IProductItem {

    Свойства:

    id:string - идентефикатор товара
    title: string - Название товара
    description: string - Описание товара
    image: string - Ссылка на изображение товара
    category: string - Категория товара
    price: number - Цена товара
    chosen:boolean - статус товара (в заказе или нет)
}
```
- Заказ, корзина
```
interface IOrder {

    Свойства:

    items: string[] - массив id выбранных товаров
    email: string - электронная почта покупателя
    phone: string - телефон покупателя
    address: string - адрес доставки покупателя
    payment:string - способ оплаты
    total: number - сумма заказа
}
```
- Тип данных о покупателе
``` 
interface ICustomer {

    Свойства:

    email: string - электронная почта покупателя
    phone: string - телефон покупателя
    address: string - адрес доставки покупателя
    payment:string - способ оплаты
}
```
- Данные для создания новой карточки товара
```
     type TProductItemInfo = Pick<IProductItem,'id'|'title' | 'description' | 'image' | 'category' | 'price' | 'chosen'>
```
- Данные для создания заказа из корзины
``` 
type TOrder = Pick<IOrder, 'address'|'payment'>
```
- Данные электронной почты, телефона покупателя, способа оплаты и адреса доставки
```
 type TOrderContacts = Pick<ICustomer, 'email' | 'phone' | 'payment' | 'address'>
```
- Данные для проверки полей формы
``` 
type FormErrors = Partial<Record<keyof ICustomer, string>>
```
- Тип для отправки заказа на сервер
```
interface IOrderResponse {
    id:string
    total:number
}
```
- Тип для представления попапа при успешном совершении заказа
```
 interface ISuccess {
  totalPrice: number
}
```
- API для запроса к серверу 
``` 
interface IApi {
    baseUrl: string
    get<T>(uri:string): Promise<T>
    post<T>(uri:string, data:object, method?: ApiPostMethods): Promise<T>
}
```
- Тип для модели приложения
```
 interface IAppModel {
    
    Свойства
    
    productItemList: ProductItem[] - Массив карточек товара
    order: IOrder - Информация о заказе при покупке товара
    basket: ProductItem[] - Корзина с товарами
    formErrors: FormErrors - Ошибки при заполнении форм
    
    Методы
    
    toOrderList(value: ProductItem): void - Метод для добавления товара в корзину
    outOfOrderList(id: string): void - Метод для удаления товара из корзины
    clearOrderList(): void - Метод для полной очистки корзины
    getItemsInOrderList(): number - Метод для получения количества товаров в корзине
    getTotalPrice(): number - Метод для получения суммы цены всех товаров в корзине
    setItems(): void - Метод для добавления ID товаров в корзине в поле items для order
    setOrderField(field: keyof ICustomer, value: string): void - Метод для заполнения полей email, phone, address, payment в order
    validateContacts(): boolean; - Валидация форм для окошка "контакты"
    validateOrder(): boolean - Валидация форм для окошка "заказ"
    refreshOrder(): boolean - Очистить order после покупки товаров
    setProductItemsList(items: IProductItem[]): void - Метод для превращения данных, полученых с сервера в тип данных приложения
    resetChosen(): void - Метод для обновления поля chosen во всех товарах после совершения покупки
  }
```
 - Тип для элемента представления главной страницы
```
interface IPage {
    productItemList: HTMLElement[] - ul для вывода карточек товаров 
    counter:number - счетчик товаров в заказе
}
```
 -  Типы для выбора категорий товаров
```
 type CategoryType =
  | 'другое'
  | 'софт-скил'
  | 'дополнительное'
  | 'кнопка'
  | 'хард-скил'

 type CategoryArray = {
  [Key in CategoryType]: string
}

  const category: CategoryArray = {
	'другое': 'card__category_other',
	'софт-скил': 'card__category_soft',
	'дополнительное': 'card__category_additional',
	'кнопка': 'card__category_button',
	'хард-скил': 'card__category_hard',
  }

 - Тип для представления окна заказа
``` interface IOrderList {
    list: HTMLElement[] - список товаров в заказе
    price: number - сумма
  }
```
 - Тип для представления модального окна
``` 
interface IPopupView{
    content: HTMLElement - наполнение модального окна
    }
```
 - Тип для представления формы внутри модальных окон 
``` 
interface IForm {valid: boolean, errors: string[]}
```
 - Тип для установки кастомных событий
```
interface ICardActions {onClick: (event: MouseEvent) => void}
```
 - Тип для представления событий при завершении заказа
```
interface ISuccessActions {onClick: (event: MouseEvent) => void}
```
## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой модели, отвечает за хранение и изменение данных
- слой представления, отвечает за отображение данных на странице, 
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы класса являются дженериками: 
- `get<T>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post<T>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий. 
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс MainModel
Это абстрактный класс являющийся общей моделью для всех моделей в приложении.\
Конструктор класса принимает данные для модели и инстант брокера событий\
Метод класса:
- emitChanges(event:string,payload?: object): void - отслеживает изменения в дочерних классах при возникновении определенного события

#### Класс AppModel
Класс является моделью данных приложения.\
Наследует класс MainModel, в качестве типа данных используется IAppModel с переопределением его полей и методов

#### Класс ProductItem
Класс является моделью данных отдельного товара.\
Наследует класс MainModel, в качестве типа данных используется IProductItem с переопределением его полей

### Классы представления
Все классы представления отвечают за отображение передаваемых в них данных внутри контейнера(DOM-элемент).

#### Класс MainComponent
Абстрактный класс содержащий общие методы для работы со всеми компонентами представления.\
Конструктор класса принимает контейнер с дочерними компонентами и предоставляет методы для изменения их состояния.\
\
Методы класса:\

- toggleClass(element: HTMLElement, className: string, force?: boolean): void - изменение класса элемента
- setText(element: HTMLElement, value: string): void - добавление текста в свойство textContent элемета
- setDisabled(element: HTMLElement, state: boolean): void - присвоение элементу атрибута disabled
- setHidden(element: HTMLElement): void -  присвоение элементу атрибута hidden
- setVisible(element: HTMLElement): void -  присвоение элементу атрибута visible
- setImage(element: HTMLImageElement, src: string, alt?: string): void - присвоение элементу с изображением ссылки на расположение и альтернативного текста
- render(data?: Partial<T>): HTMLElement - отрисовка компонента

#### Класс MainPage
Отрисовывает главное окно.\
Конструктор принимает контейнер с элементами и инстант брокера событий.\
Поля класса:\
   - _counter: HTMLElement - счетчик количества товаров в заказе
   - _productItemList: HTMLElement - список товаров
   - _wrapper: HTMLElement - контейнер для списка товаров
   - _basket: HTMLElement - компонент заказа (принято название исходя из классов верстки)

Методы класса являются сеттерами, определяющими поля списка товаров, число товаров в заказе и ограничение на прокрутку основного окна при открытии модальных окон

#### Класс Popup
Отрисовывает модальные окна в приложении. Так же предоставляет методы `open` и `close` для управления отображением модального окна и `render` для отрисовки в окне браузера. Устанавливает слушатели на клик в оверлей и кнопку-крестик для закрытия попапа.\
\
Конструктор принимает контейнер с элементами и инстант брокера событий.\
\
Поля класса:\
- _closeButton: HTMLButtonElement - кнопка закрытия модального окна
- _content: HTMLElement - контейнер с содержимым модального окна


#### Класс OrderList
Отрисовывает модальное окно заказа.\
Конструктор принимает имя блока из верстки, контейнер с элементами и инстант брокера событий.\
Поля класса:\
 - _list - список товаров
 - _price - цена
 - _button - кнопка оформления заказа
Методы класса являются сеттерами, определяющими поля списка товаров.
Метод refreshCountInOrderList(): обновляет число товаров в заказе

#### Класс Form
Расширяет класс MainComponent, в качестве типа принимает интерфейс IForm. Предназначен для реализации формы содержащей различные поля ввода в модальном окне.\
При сабмите инициирует событие, передавая в него объект с данными из полей ввода формы.\
При изменении данных в полях ввода инициирует событие изменения данных. \
\
Конструктор принимает контейнер с элементами и инстант брокера событий.\
\
Методы класса являются сеттерами, определяющими поля ошибок и деактивацию кнопки отправки формы при появлении ошибки.
Метод render(state) - выводит сообщение при возникновении ошибки

### Слой коммуникации
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера, согласно парадигме MPV

#### Класс AppApi
Реализует интерфейс IApi\
\
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.\
getProductItemList() - возвращает промис в виде массива с карточками с сервера


## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*

- `popup:close` - закрытие модального окна
- `items:changed` - изменение в товаре
- `card:select` - выбор товара, открытие подробного описания
- `card:toOrderList` - добавление товара в заказ
- `orderList:delete` - удаление товара из заказа
- `orderList:open` - открытие окна заказа
- `orderFormErrors:change` - ошибка при вводе способа оплаты и адреса доставки
- `contactsFormErrors:change` - ошибка при вводе электронной почты и телефона покупателя
- `orderInput:change` - появление символов с клавиатуры в полях ввода
- `order:submit` - отправка формы после ввода способа оплаты и адерса доставки
- `contacts:submit` - отправка формы после ввода электронной почты и телефона покупателя на сервер
- `order:success` - возвращение на главную страницу за новым заказом